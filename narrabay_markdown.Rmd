---
title: "Narragansett Bay Commision: Chlorophyll and Temperature"
editor_options:
  chunk_output_type: console
date: '2018-03-09'
output:
  html_document:
    toc: yes
    toc_depth: 3
    toc_float: true
params:
  year1: 2017
  year2: 2018
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(repos="http://cran.rstudio.com/")
pkgs <- c("ggplot2", "googlesheets", "dplyr", "tidyr", "readr", "plotly", "DT")
for(i in pkgs){
  if(!i %in% installed.packages()){
    install.packages(i)
  }
}
x<-lapply(pkgs, library, character.only = TRUE)
#install.packages("lubridate")
#library(lubridate)
```

# Purpose

The purpose of this document is to serve as motivating example (i.e. R, Markdown, and Open data are cool!), but will also serve to structure the rest of this workshop in that we will see how to work with and visualize data in R and combine code and documentation with R Markdown. Additionally, the tools we will be using come from [The Tidyverse](https://tidyverse.org) which is an opinionated (but effective) way to think about organizing and analyzing data in R.

# The Example

Since the Narragansett Bay Commission has data availble directly from the web (very cool!), we will use that as our example.  Even better, the way to table builder is structured it essentially works as an API (Application Programming Interface) and we can build our queries by hand and hit the service directly from R.

## Get Data 

```{r get_data}
date_url <- paste0(params$year1,"/01/01 12:00 AM-",params$year2,"/12/31 11:59 PM")
date_url_enc <- RCurl::curlEscape(date_url)

url <- paste0("http://snapshot.narrabay.com/app/Data/ExportCsv?page=1&p=Chl,pH,Temp,Z&t=",
              date_url_enc, 
              "&l=5,9,6,7,8,1,2,3,4")

narrabay_data<-read_csv(url)
```

## Manipulate Data

Let's tidy up this dataset.

```{r tidy}
# separate location from layer
# separate date and time
# aggregate into hourly and surface:bottom average
datatable(narrabay_data)
```

## Visualize Data

Next step is to visualize the data.  Let's look at the association between average temperature and chlorophyll.

```{r plot_it, warning=FALSE, message=FALSE, eval=F}
ggplotly()
```


